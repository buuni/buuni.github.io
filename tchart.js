var TChart=function(){"use strict";function t(t,e){Object.keys(t).forEach(function(i,n){return e(t[i],i,n)})}function e(t){return document.createTextNode(t)}function i(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function n(t){return t>1e4?(t/1e3).toFixed(0)+"K":t}function o(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}var a=function(e,i){var n=this;void 0===i&&(i={}),this._el=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}(e),t(i,function(t,e){"style"!==e?n.attr(e,t):n.style(t)})},r={node:{configurable:!0}};r.node.get=function(){return this._el},a.prototype.attr=function(){var e=this;if(!(arguments.length>1))return"object"==typeof arguments[0]?void t(arguments[0],function(t,i){e.attr(i,t)}):this._el.getAttribute(i(arguments[0]));this._el.setAttribute(i(arguments[0]),arguments[1])},a.prototype.style=function(){var e=this;if(!(arguments.length>1))return"object"==typeof arguments[0]?void t(arguments[0],function(t,i){e.style(i,t)}):this._el.style[i(arguments[0])];this._el.style[i(arguments[0])]=arguments[1]},a.prototype.addEventListener=function(t,e){this._el.addEventListener(t,e)},a.prototype.mount=function(t){t instanceof a?t._el.appendChild(this._el):t.appendChild(this._el)},Object.defineProperties(a.prototype,r);var s=function(t){this._layout=new l(t),this._layout.push(this)},h={layout:{configurable:!0}};h.layout.get=function(){return this._layout},h.layout.set=function(t){},Object.defineProperties(s.prototype,h);var l=function(t){this._container=t?new a(t):null,this._collection=[],this._mounted=!1,this._position={},this._viewbox={width:0,height:0}};l.prototype.viewbox=function(t){this._viewbox=t},l.prototype.position=function(t){this._position=t},l.prototype.push=function(){for(var t,e=[],i=arguments.length;i--;)e[i]=arguments[i];(t=this._collection).push.apply(t,e)},l.prototype.render=function(t){this._collection.forEach(function(e){(e instanceof l||e instanceof s)&&e.render(t)})},l.prototype.mount=function(t){var e=this;this._mounted||(t instanceof l||t instanceof a||t instanceof s?this._container?(this._collection.forEach(function(t){t instanceof a||t instanceof l||t instanceof s?t.mount(e._container):e._container.appendChild(t)}),this._container.mount(t)):this._collection.forEach(function(e){e instanceof a||e instanceof l||e instanceof s?e.mount(t):t.appendChild(e)}):this._container?(this._collection.forEach(function(t){t instanceof a||t instanceof l||t instanceof s?t.mount(e._container):e._container.appendChild(t)}),t.appendChild(this._container.node)):this._collection.forEach(function(e){e instanceof a||e instanceof l||e instanceof s?e.mount(t):t.appendChild(e)}),this._container&&this._container.attr("transform","translate("+(this._position.left||0)+" "+(this._position.top||0)+")"),this._mounted=!0)};var c={Root:{background:"white"},Navigator:{height:50,background:"white",Drawer:{handlerWidth:10,border:4,maskColor:"#F6FAFC",borderColor:"rgba(20,123,123,0.2)"},Line:{linejoin:"round",size:1}},Tooltip:{Mark:{background:"white"},labelColor:"#222222",background:"white",borderColor:"#D8D8D8",wayLineColor:"#DFE6EB"},Plot:{Line:{linejoin:"round",size:2},yAxis:{lineColor:"#F2F4F5",textColor:"#96A2AA"},xAxis:{textColor:"#96A2AA"}}},u={Root:{background:"#242F3E"},Navigator:{height:50,background:"#242F3E",Drawer:{handlerWidth:10,border:4,maskColor:"#1F2A38",borderColor:"rgba(64,87,106,1)"},Line:{linejoin:"round",size:1}},Tooltip:{Mark:{background:"#242F3E"},labelColor:"white",background:"#253241",borderColor:"#212D3A",wayLineColor:"#3B4A5A"},Plot:{Line:{linejoin:"round",size:2},yAxis:{lineColor:"#293544",textColor:"#546778"},xAxis:{textColor:"#546778"}}},_=0,p=function(t){this._target=t,this._rel=[],this._watchers=[],this._id=++_};function d(t){var e=null;return Array.isArray(t)?e=t.slice(0):"object"==typeof t&&t instanceof Object&&(e=Object.assign({},t)),f(e),e}function f(e){return Array.isArray(e)?(n=new p(i=e),i.forEach(function(t){-1!==f(t)&&n.addRelation(t.__ob)}),m(i,"__ob",n),b.forEach(function(t){var e=g[t];m(y,t,function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];var n=e.apply(this,t);return this.__ob.notify(null,e),n})}),b.forEach(function(t){m(i,t,y[t])}),1):"object"==typeof e&&e instanceof Object?(function(e){var i=new p(e);t(e,function(t,n){(Array.isArray(t)||"object"==typeof t&&t instanceof Object)&&(f(t),i.addRelation(t.__ob)),Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){if(e!==t){t.__ob&&t.__ob instanceof p&&f(e);var o=t;t=e,i.notify(n,e,o)}}})}),m(e,"__ob",i)}(e),1):-1;var i,n}function m(t,e,i,n){void 0===n&&(n=!1),Object.defineProperty(t,e,{value:i,enumerable:!!n,writable:!0,configurable:!0})}p.prototype.addRelation=function(t){this._rel.push(t),t.watch(this.notify.bind(this))},p.prototype.watch=function(t){this._watchers.push(t)},p.prototype.notify=function(t,e,i){this._watchers.forEach(function(n){return n(t,e,i)})};var g=Array.prototype,y=Object.create(g),b=["push","pop","shift","unshift","splice","sort","reverse"];function v(e,i){"object"==typeof i&&i instanceof Object&&t(i,function(t,i){if("undefined"!==e[i]){var n=null;t&&"[object Function]"==={}.toString.call(t)?n=t:(n=t.handler,t.deep||!1),e.__ob.watch(function(t,e,o){t===i&&n(e,o)})}})}function x(t){var e=performance.now();return requestAnimationFrame(function i(n){var o=(n-e)/t.duration;o>1&&(o=1);var a=t.timing(o);t.draw(a),o<1&&requestAnimationFrame(i)})}var w=function(t,e){this._theme=t,this._options=e,this._container=new a("polyline",{stroke:e.color,strokeWidth:t.size,fill:"none",strokeLinecap:t.linejoin,strokeLinejoin:t.linejoin,style:{willChange:"auto"}})};w.prototype.changeVisible=function(t){var e=this;this._visible=t,x({duration:200,timing:function(t){return t},draw:function(i){e._container.style("opacity",t?i:1-i)}})},w.prototype.redraw=function(t){t.viewbox.width,t.points.length;var e=t.viewbox.width/(t.points.length-1),i=t.viewbox.height/t.max;this.xRatio=e,this.yRatio=i;for(var n=0,o=[],a=0;a<t.points.length;a++){var r=t.points[a];o.push(n*e),o.push((t.max-r)*i),n++}this._container.attr("points",o.join(","))};var k=function(e){function i(t){var i=this;e.call(this,"g"),this._state=t,this._maxValue=0,this._minValue=0,this._lines={},this._animateQueue={},Object.keys(t.data).forEach(function(e){v(t.data[e],{data:function(){return i._handlerUpdateData(e)},visible:function(t,n){return i._changeVisible(e,t)}}),i._lines[e]=new w(t.theme.Line,{color:t.data[e].color})}),this._recalc(),this._timer=null}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._recalc=function(){var e=[];t(this._state.data,function(t){t.visible&&e.push.apply(e,t.data)}),this._prevMaxValue=this._maxValue,this._prevMinValue=this._minValue,this._maxValue=Math.max.apply(Math,e),this._minValue=Math.min.apply(Math,e),this._state.maxValue=this._maxValue,this._state.minValue=this._minValue,0===this._prevMaxValue&&(this._prevMaxValue=5*this._maxValue)},i.prototype._handlerUpdateData=function(t){var e=this;this._prevMaxValue=this._maxValue,this._prevMinValue=this._minValue,this.render(),this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout(function(){e._recalc(!1),e._render(),e._timer=null,clearTimeout(e._timer)},100)},i.prototype._changeVisible=function(t,e){this._recalc(),this.render(),this._lines[t].changeVisible(e)},i.prototype.mount=function(e){t(this._lines,function(t){t._container.mount(e)})},i.prototype._render=function(e){var i=this,n=this._state.data[Object.keys(this._state.data)[0]].data.length;Object.keys(this._state.data).every(function(t){return i._state.data[t].data.length===n})&&t(this._lines,function(t,n){e&&i._animateQueue[n]||(i._animateQueue[n]=!0,x({duration:200,timing:function(t){return t},draw:function(e){var o=i._prevMaxValue-i._maxValue;t.redraw({points:i._state.data[n].data,max:i._prevMaxValue-o*e,min:i._minValue,viewbox:i._layout._viewbox}),e>=1&&(i._animateQueue[n]=!1)}}))})},i.prototype.render=function(){this._render(!0)},i}(s),C=function(t){function i(e){t.call(this,"g"),this._state=e,this._oldMax=0,this._max=e.maxValue,this._height=400,this._width=400,this._linesCount=5,this._zeroLine=null,v(e,{maxValue:this._changeMax.bind(this),theme:this._changeTheme.bind(this)}),this._container=new a("g"),this._currentGroup="first",this._labels={first:[],second:[]}}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype._changeTheme=function(){var t=this,e=this._labels.first.concat(this._labels.second);this._zeroLine&&e.push(this._zeroLine),e.forEach(function(e){console.log(e),e.label.attr("stroke",t._state.theme.yAxis.textColor),e.line.attr("stroke",t._state.theme.yAxis.lineColor)})},i.prototype._changeMax=function(t){this._oldMax=this._max,console.log("change max"),this._max=t,this.render()},i.prototype._createLabels=function(t){for(var e=[],i=1;i<=t;i++){this._height;var n=new a("line",{x1:0,y1:0,x2:this._width-20,y2:0,stroke:this._state.theme.yAxis.lineColor}),o=new a("text",{y:-10,x:0,stroke:this._state.theme.yAxis.textColor,fontSize:12,fontWeight:100}),r=new a("g",{transform:"translate(0 "+this._height+")",style:{transition:"all 200ms"}});o.mount(r),n.mount(r),e.push({container:r,label:o,line:n})}return e},i.prototype.mount=function(t){var i=this,n=this._max/this._linesCount;this._zeroLine=this._createLabels(1)[0],this._zeroLine.container.mount(this._container),this._zeroLine.container.attr("transform","translate(10 "+this._height+")"),this._zeroLine.label.node.appendChild(e(0)),this._labels.first=this._createLabels(this._linesCount),this._labels.first.forEach(function(t,o){var a=i._max-o*n;t.container.mount(i._container),t.label.node.innerHTML="",t.label.node.appendChild(e(a))}),this._labels.second=this._createLabels(this._linesCount),this._labels.second.forEach(function(t,e){t.container.mount(i._container),t.container.style("translate",""),t.container.attr("transform","")}),this._container.mount(t)},i.prototype.render=function(){var t=this;this._labels[this._currentGroup].forEach(function(t,e){t.container.style("transition","all 200ms"),t.container.attr("transform","translate(10 -100)"),t.container.style("opacity","0")}),this._currentGroup="first"===this._currentGroup?"second":"first";var i=this._max/(this._linesCount+1);this._labels[this._currentGroup].forEach(function(o,a){o.container.style("transition",""),t._max<t._oldMax&&o.container.attr("transform","translate(10 "+t._height+")"),o.container.style("opacity","0"),o.container.style("transition","all 200ms");var r=t._max-a*i-i;o.label.node.innerHTML="",o.label.node.appendChild(e(n(Math.ceil(r))));var s=t._height/(t._linesCount+1)*(a+1);o.container.attr("transform","translate(10 "+s+")"),o.container.style("opacity","1")})},i}(s),A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function M(t){return A[t.getMonth()]+" "+t.getDate()}var T=function(t){function i(e){t.call(this,"g"),this._state=e,this._container=new a("g"),this._height=375,v(e,{data:this._changeData.bind(this),theme:this._changeTheme.bind(this)}),this._labels=[]}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype._changeTheme=function(t){this._labels.forEach(function(e){e.label.attr("stroke",t.xAxis.textColor)})},i.prototype._changeData=function(t){var i=(t[t.length-1]-t[0])/6;this._saved=i;for(var n=0;n<6;n++){var o=M(new Date(t[0]+n*i));if(!this._labels[n]){var r=new a("text",{stroke:this._state.theme.xAxis.textColor,fontSize:12,fontWeight:100,alignmentBaseline:"middle"}),s=new a("g");r.node.appendChild(e(o)),r.mount(s),s.mount(this._container),this._labels[n]={label:r,container:s}}var h=this._height/6*n+10;this._labels[n].label.node.innerHTML="",this._labels[n].label.node.appendChild(e(o)),this._labels[n].container.attr("transform","translate("+h+" 0)")}},i.prototype.mount=function(t){this._container.mount(t),this._container.attr("transform","translate(15 420)")},i.prototype.render=function(){},i}(s),L=function(e){function i(t){var i=this;e.call(this,"g"),this._state=t,this._plotAreaData={data:{},theme:t.theme.Plot,maxValue:0,minValue:0},this._xAxisData=d({data:[],theme:t.theme.Plot}),this._series={},this._totalPoints=0,this._savedStartIndex=null,this._savedEndIndex=null,t.series.filter(function(t){return"x"!==t.type}).forEach(function(t){v(t,{data:i._render,visible:function(e,n){return i._changeVisible(t.id,e)}}),i._plotAreaData.data[t.id]={data:t.data,color:t.color,visible:t.visible},i._series[t.id]=t,i._totalPoints=t.data.length}),this._plotAreaData=d(this._plotAreaData),this._plotArea=new k(this._plotAreaData),this._plotArea.layout.viewbox({width:400,height:400}),this._yAxis=new C(this._plotAreaData),this._xAxis=new T(this._xAxisData),v(t,{range:this._changeRange.bind(this),theme:this._changeTheme.bind(this)}),this._changeRange(this._state.range);var n=new a("rect",{fill:"transparent",height:420,width:400});n._el.addEventListener("mousemove",this._tooltipHandler.bind(this)),n._el.addEventListener("touchmove",this._tooltipHandler.bind(this)),this._layout.push(n),this._layout.push(this._yAxis),this._layout.push(this._xAxis),this._layout.push(this._plotArea)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._changeTheme=function(t){this._plotAreaData.theme=t.Plot,this._xAxisData.theme=t.Plot},i.prototype._tooltipHandler=function(t){var e=t.offsetX?t.offsetX:t.layerX;this._calcTooltip(e)},i.prototype._calcTooltip=function(e){this._savedX=e;var i=0,n=this._plotArea._maxValue;if(t(this._plotAreaData.data,function(t,e){t.visible&&(i=t.data.length)}),0!==i){var o=400/(i-1),a=400/n,r=Math.ceil((e-o/2)/o);this._state.tooltip.visible=!0;var s=this._testTooltip(r,o,a);this._state.tooltip.data=s,this._state.tooltip.xRatio===o&&this._state.tooltip.yRatio===a&&this._state.tooltip.index===r||(this._state.tooltip.xRatio=o,this._state.tooltip.yRatio=a,this._state.tooltip.index=r,this._state.tooltip.label=this._xAxisData.data[r])}},i.prototype._testTooltip=function(e,i,n){var o=[];return t(this._plotAreaData.data,function(t,i){t.visible&&o.push({id:i,value:t.data[e]})}),o},i.prototype.mount=function(t){},i.prototype.render=function(){},i.prototype._render=function(){},i.prototype._changeRange=function(e){var i=this,n=e.left*this._totalPoints,o=(e.left+e.value)*this._totalPoints,a=Math.trunc(n),r=Math.trunc(o);this._state.tooltip.visible=!1,a=a>0?a-1:a,r=r<this._totalPoints-1?r+1:r,this._savedStartIndex===a&&this._savedEndIndex===r||(this._savedStartIndex=a,this._savedEndIndex=r,this._xAxisData.data=this._state.series.find(function(t){return"x"===t.type}).data.slice(a,r),t(this._plotAreaData.data,function(t,e){t.data=i._series[e].data.slice(a,r)}))},i.prototype._changeVisible=function(t,e){this._state.tooltip.visible=!1,this._plotAreaData.data[t].visible=e},i}(s);var D=function(t,e,i){this._theme=e,this._state=t,this._options=i,this.$container=new a("g"),this.$drawerContainer=new a("g"),this._init()};D.prototype.changeTheme=function(t){this._theme=t;var e=this._theme.handlerWidth,i=(this._theme.border,this._theme.maskColor),n=this._theme.borderColor;this.$left.attr({width:e}),this.$right.attr({width:e}),this.$backMask.attr({fill:i}),this.$borderMask.attr({fill:n})},D.prototype._init=function(){var e,i,n,r,s,h,l,c,u,_=this,p=this._options.height,d=this._options.width,f=this._theme.handlerWidth,m=this._theme.border,g=this._theme.maskColor,y=this._theme.borderColor,b=o(10);this.$maskContainer=new a("mask",{id:b}),this.$left=new a("rect",{width:f,height:p,fill:"transparent",x:d*this._state.range.left,y:0}),this.$right=new a("rect",{width:f,height:p,fill:"transparent",x:d*this._state.range.left-f,y:0}),this.$contains=new a("rect",{width:d*this._state.range.value-2*f,height:p-2*m,x:d*this._state.range.left+f,y:m,class:"contains"}),this.$backMask=new a("rect",{width:d,height:p,fill:g,x:0,y:0,mask:"url(#"+b+")"}),this.$borderMask=new a("rect",{width:d*this._state.range.value,height:p,x:d*this._state.range.left,y:0,fill:y,mask:"url(#"+b+")",style:{cursor:"ew-resize"}}),this.$alpha=new a("rect",{width:"100%",height:"100%",fill:"rgba(255,255,255, 0.5)"}),this.$alpha.mount(this.$maskContainer),this.$contains.mount(this.$maskContainer),this.$maskContainer.mount(this.$container),this.$backMask.mount(this.$container),this.$borderMask.mount(this.$drawerContainer),this.$right.mount(this.$drawerContainer),this.$left.mount(this.$drawerContainer),this.$drawerContainer.mount(this.$container),e=this.$contains,i={resizers:{left:this.$left,right:this.$right},maxWidth:d-2*f,minWidth:f,maxX:d-f,minX:0,hooks:{after:function(t,e,i){var n=(t+2*f)/d,o=e/d;_._state.range={left:o,value:n},_.$borderMask.attr("x",e),_.$borderMask.attr("width",t+2*f)}}},n=e._el,r=0,s=0,h=0,l=0,c=0,u=0,t(i.resizers,function(t,o){var a=t._el,_=function(i){i.preventDefault(),r=parseFloat(getComputedStyle(n,null).getPropertyValue("width").replace("px","")),parseFloat(getComputedStyle(n,null).getPropertyValue("height").replace("px","")),s=parseFloat(e.attr("x")),n.getBoundingClientRect().top,h=i.pageX,i.pageY,l=parseFloat(t.attr("x")),window.addEventListener("mousemove",p),window.addEventListener("touchmove",p),window.addEventListener("mouseup",d),window.addEventListener("touchend",d)};function p(n){if("right"===o){var a=r+(n.pageX-h),_=l-(r-a);a>=i.minWidth&&a<=i.maxWidth&&_>=i.minX&&_<=i.maxX&&(e.attr("width",a),t.attr("x",_),u=i.maxX-_,i.hooks.after(a,_-a-10,u))}else if("left"===o){var p=r-(n.pageX-h),d=l+(r-p);p>=i.minWidth&&p<=i.maxWidth&&d>=i.minX&&d<=i.maxX&&(e.attr("width",p),e.attr("x",s+(n.pageX-h)),t.attr("x",d),c=d,i.hooks.after(p,c,u))}}function d(){window.removeEventListener("mousemove",p),window.removeEventListener("touchmove",p)}a.addEventListener("touchstart",_),a.addEventListener("mousedown",_)}),function(t,e){var i=t._el,n=0,o=0,a=0,r=function(r){function s(i){var r=o+i.pageX-a;r>=e.minX&&r+n<=e.maxX&&(t.attr("x",r),e.hooks.after(n,r))}function h(){window.removeEventListener("touchmove",s),window.removeEventListener("mousemove",s)}r.preventDefault(),n=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px","")),o=parseFloat(t.attr("x")),i.getBoundingClientRect().top,a=r.pageX,r.pageY,window.addEventListener("mousemove",s),window.addEventListener("touchmove",s),window.addEventListener("mouseup",h),window.addEventListener("touchend",h)};t.addEventListener("mousedown",r),t.addEventListener("touchstart",r)}(this.$borderMask,{maxX:d,minX:0,hooks:{after:function(t,e){var i=t/d,n=e/d;_._state.range={left:n,value:i},_.$contains.attr("x",e+f),_.$borderMask.attr("x",e),_.$left.attr("x",e),_.$right.attr("x",e+t-f)}}})};var E=function(t){function e(e){var i=this;t.call(this,"g"),this._state=e,v(e,{theme:function(t){i._plotAreaData.theme=t.Navigator,i._drawer.changeTheme(t.Navigator.Drawer),i._bg.attr("fill",e.theme.Navigator.background)}}),this._bg=new a("rect",{width:380,height:50,fill:e.theme.Navigator.background}),this._plotAreaData={data:{},theme:e.theme.Navigator},this._series=e.series.filter(function(t){return"x"!==t.type}).map(function(t){return v(t,{data:i._render,visible:function(e,n){return i._changeVisible(t.id,e)}}),i._plotAreaData.data[t.id]={data:t.data,color:t.color,visible:t.visible},t}),this._plotAreaData=d(this._plotAreaData),this._plotArea=new k(this._plotAreaData),this._plotArea.layout.viewbox({width:378,height:42}),this._plotArea.layout.position({top:4,left:1}),this._drawer=new D(e,e.theme.Navigator.Drawer,{width:380,height:e.theme.Navigator.height}),this._layout.push(this._bg),this._layout.push(this._plotArea.layout),this._layout.push(this._drawer.$container)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.mount=function(t){},e.prototype.render=function(){},e.prototype._render=function(){},e.prototype._changeData=function(){console.log("changeData")},e.prototype._changeVisible=function(t,e){this._plotAreaData.data[t].visible=e},e}(s),V=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var j=function(t){this._state=t,this._container=new a("g",{style:{transition:"all 100ms"}}),this._textGroup=new a("g"),this._ratio=0,this._textGroup.attr("transform","translate(0, 35)"),this._tooltipWidth=100,this._tooltipHeight=60,this._bg=new a("rect",{width:this._tooltipWidth,height:this._tooltipHeight,fill:t.theme.Tooltip.background,stroke:t.theme.Tooltip.borderColor,strokeWidth:1,rx:5,ry:5}),this._header=new a("text",{x:10,y:15,alignmentBaseline:"middle",fontSize:12,strokeWidth:0,fill:t.theme.Tooltip.labelColor}),this._wayLine=new a("line",{x1:0,y1:0,x2:0,y2:420,stroke:t.theme.Tooltip.wayLineColor,visibility:"hidden"}),this._contentText=[],this._label="",v(t,{theme:this._changeTheme.bind(this)}),this._bg.mount(this._container),this._header.mount(this._container),this._textGroup.mount(this._container),this._container.attr("visibility","hidden")};j.prototype._changeTheme=function(t){this._header.attr("fill",t.Tooltip.labelColor),this._wayLine.attr("stroke",t.Tooltip.wayLineColor),this._bg.attr({fill:t.Tooltip.background,stroke:t.Tooltip.borderColor})},j.prototype.changeVisible=function(t){this._container.attr("opacity",t?1:0),this._container.attr("visibility",t?"visible":"hidden"),this._wayLine.attr("visibility",t?"visible":"hidden")},j.prototype.render=function(){var t,i=this._state.tooltip.data.map(function(t){return t.value});this._header.node.innerHTML="",this._label=(t=new Date(this._state.tooltip.label),$[t.getDay()]+", "+V[t.getMonth()]+" "+t.getDate()),this._header.node.appendChild(e(this._label)),this._renderText(this._state.tooltip.data),this.setPosition(this._state.tooltip.index,this._state.tooltip.xRatio,this._state.tooltip.yRatio,Math.max.apply(Math,i))},j.prototype._renderText=function(e){var i=this,o=0;e.forEach(function(t){var e=i._state.series.find(function(e){return e.id===t.id}),a=n(t.value);i._contentText[t.id]||(i._contentText[t.id]=i._createTextGroup()),o=(o=o<a.toString().length?a.toString().length:o)<e.label.toString().length?e.label.toString().length:o,i._updateTextNode(i._contentText[t.id],e.label,a,e.color)}),o*=12;var a={};t(this._contentText,function(t,i,n){t.visible&&e.find(function(t){return t.id===i})?(a[i]=t,t.container.attr("visibility","visible")):t.container.attr("visibility","hidden")});var r=2*o+10,s=6.2*this._label.length+20;s>r&&(o=s/2),t(a,function(t,e,i){var n=35*Math.floor(i/2);t.container.attr("transform","translate("+(i%2*o+10)+" "+n+")")}),this._tooltipWidth=r>s?r:s,this._tooltipHeight=35*Math.ceil(Object.keys(a).length/2)+30},j.prototype._updateTextNode=function(t,i,n,o){t.container.style("fill",o),t.label._el.innerHTML="",t.value._el.innerHTML="",t.label._el.appendChild(e(i)),t.value._el.appendChild(e(n))},j.prototype._createTextGroup=function(){var t=new a("g"),e=new a("text",{style:{fontWeight:200,fontSize:"12px"},y:15,alignmentBaseline:"middle"}),i=new a("text",{style:{fontWeight:600,fontSize:"14px"},alignmentBaseline:"middle"});return i.mount(t),e.mount(t),t.mount(this._textGroup),{container:t,label:e,value:i,visible:!0}},j.prototype.setPosition=function(t,e,i,n){var o=0,a=400-n*i,r=t*e,s=this._tooltipWidth,h=e;h>20?h=20:h<10&&(h=10),(o=a<this._tooltipHeight+h?r+s+h>400?r-s-h:r+h:r+s-h>400?r-s+h:r-h)<h?o=h:o+s+h>400&&(o=400-s-h);var l="translate("+(o=o>h?o:h)+" 0)",c="translate("+t*e+" 0)";this._container.attr("transform",l),this._bg.attr({width:this._tooltipWidth,height:this._tooltipHeight}),this._wayLine.attr("transform",c)};var F=function(e){function i(t){e.call(this,"g"),this._state=t,this._wrapper=new j(t),this._marksContainer=new a("g"),this._marks={},v(t.tooltip,{visible:this._changeVisible.bind(this),data:this._changeData.bind(this)}),v(t,{theme:this._changeTheme.bind(this)})}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype._changeTheme=function(e){t(this._marks,function(t){t.attr("fill",e.Tooltip.Mark.background)})},i.prototype._changeVisible=function(e){this._wrapper.changeVisible(e),t(this._marks,function(t){t.style("visibility","hidden")})},i.prototype._changeData=function(){var t=this;this._wrapper.render(),this._state.tooltip.data.forEach(function(e){if(!t._marks[e.id]){var i=t._state.series.find(function(t){return t.id===e.id});t._marks[e.id]=new a("circle",{r:5,stroke:i.color,strokeWidth:3,fill:t._state.theme.Tooltip.Mark.background,style:{visibility:"hidden"}}),t._marks[e.id].mount(t._marksContainer)}t._marks[e.id].attr({cx:t._state.tooltip.index*t._state.tooltip.xRatio,cy:420-e.value*t._state.tooltip.yRatio}),t._marks[e.id].style("visibility","visible")}),Object.keys(this._marks).forEach(function(e){t._state.tooltip.data.find(function(t){return t.id===e})||t._marks[e].style("visibility","hidden")})},i.prototype.mount=function(t){this._wrapper._wayLine.mount(t),this._marksContainer.mount(t),this._wrapper._container.mount(t)},i.prototype.render=function(){},i}(s),O=function(t){var e=this;this._options=t,this._root=new l("svg");var i=t.columns.map(function(e){var i=e[0];return{id:i,data:e.slice(1),visible:!0,type:t.types[i],color:t.colors[i]||null,label:t.names[i]||null}});this._state=d({series:i,tooltip:{filterId:o(10),visible:!1,data:[],index:0,xRatio:0,yRatio:0,label:""},theme:c,range:{left:.65,value:.35}}),v(this._state,{theme:function(){e._root._container.style("background",e._state.theme.Root.background)}}),this._init()};return O.prototype._init=function(){var t=new L(this._state),e=new E(this._state),i=new F(this._state);t.layout.position({top:20}),e.layout.position({top:460,left:10}),this._root.push(e.layout),this._root.push(t.layout),this._root.push(i.layout)},O.prototype.changeTheme=function(t){this._state.theme="night"===t?u:c},O.prototype.mount=function(t){return this._root.viewbox({width:400,height:520}),this._root._container.attr({width:"400px",height:"520px",viewbox:"0 0 400 520",version:1.1,xmlns:"http://www.w3.org/2000/svg",style:{background:this._state.theme.Root.background}}),this._root._container.style("fontFamily","Roboto"),this._root._container._el.insertAdjacentHTML("afterBegin",'<defs><filter id="'+this._state.tooltip.filterId+'" x="-0.5" y="-0.5" width="200%" height="200%"><feGaussianBlur in="SourceAlpha" stdDeviation="3"></feGaussianBlur> \x3c!-- stdDeviation is how much to blur --\x3e<feOffset dx="0" dy="0" result="offsetblur"></feOffset> \x3c!-- how much to offset --\x3e<feComponentTransfer><feFuncA type="linear" slope="0.08"></feFuncA> \x3c!-- slope is the opacity of the shadow --\x3e</feComponentTransfer><feMerge><feMergeNode></feMergeNode> \x3c!-- this contains the offset blurred image --\x3e<feMergeNode in="SourceGraphic"></feMergeNode> \x3c!-- this contains the element that the filter is applied to --\x3e</feMerge></filter><filter x="0" y="0" width="1" height="1" id="solid"><feFlood flood-color="white"/><feComposite in="SourceGraphic" operator="xor" /></filter></defs>'),this._root.mount(t),this},O.prototype.render=function(t){this.changeTheme(t),this._root.render()},O}();
